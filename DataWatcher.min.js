/*!
 * DataWatcher.js v1.0
 * (c) 2016 Marco Marchiò
 * Released under the MIT License.
 */
!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():t.DataWatcher=e()}(this,function(){var t=0,e=0,r=Object.prototype.toString,n=function(t){return"[object Array]"===r.call(t)},i=function(t){return null!==t&&"[object Object]"===r.call(t)},u=function(t){return"function"==typeof t},o=function(t){return n(t)||i(t)},f=function(t){if(n(t))return t;if(!t)return[];for(var e,r=[],i="",u=!1,o=!1,f=0,c=t.length;c>f;f++)e=t[f],"."!==e||u||o?"*"!==e||u||o?"\\"!==e||o?"["!==e||o||u?"]"===e&&!o&&u?(i&&r.push(i),i="",u=!1):(i+=e,o=!1):(i&&r.push(i),i="",u=!0):o=!0:(r.push(!0),i=""):(i&&r.push(i),i="");return i&&r.push(i),r},c=function(t,e){var r=t.length,n=e.length;if(n>r)return!1;for(var i,u,o=0;n>o;o++)if(i=t[o],u=e[o],u!==!0&&i!==u)return!1;return 1>=r-n||e[n-1]===!0},a={},l=function(t,e,r){t in a||(a[t]=[]),a[t].push([f(e),r])},h=function(t,e,r,n){if(t in a&&a[t].length){var i={path:e,oldValue:r,newValue:n,type:void 0===r?v.type.ADDED:void 0===n?v.type.DELETED:v.type.MODIFIED};a[t].forEach(function(t){c(e,t[0])&&t[1](i)})}},p=function(t,e){if(t===e)return!0;if(n(t)&&n(e)){var r=t.length;if(r!==e.length)return!1;for(var u=0;r>u;u++)if(!p(t[u],e[u]))return!1;return!0}if(i(t)&&i(e)){var o=Object.keys(t),r=o.length;if(r!==Object.keys(e).length)return!1;for(var u=0;r>u;u++){if(!(o[u]in e))return!1;if(!p(t[o[u]],e[o[u]]))return!1}return!0}return!1},d=function(t,e,r){if(!t){var n=Object.getOwnPropertyDescriptor(e,r);if(n)return n.writable}return!0},s=function(t,r,n){var i={set:function(i,u,f){var c,a=!0;if(d(n,i,u)){if(c=i[u],!p(c,f)){try{i[u]=o(f)?y(f,t,r.concat([u])):f}catch(l){a=!1}e||!a||n&&"length"===u||h(t.getId(),r.concat([u+""]),c,f)}}else a=!1;return a},deleteProperty:function(e,i){var u,o=!0;if(d(n,e,i)){u=e[i];try{delete e[i]}catch(f){o=!1}o&&h(t.getId(),r.concat([i+""]),u)}else o=!1;return o}};return n?i.get=function(t,e){return t[e]}:i.defineProperty=function(t,e,r){return"value"in r&&(this.set(t,e,r.value),delete r.value),Object.defineProperty(t,e,r),!0},i},y=function(t,r,i){var u,o;if(e++,n(t))u=[],o=new Proxy(u,s(r,i,!0)),t.forEach(function(t){o.push(t)});else{u={},o=new Proxy(u,s(r,i));for(var f in t)t.hasOwnProperty(f)&&Object.defineProperty(o,f,Object.getOwnPropertyDescriptor(t,f))}return e--,o},v=function(e){if(!o(e))throw"You can observe only objects and arrays";Object.defineProperty(this,"id",{value:++t,writable:!1}),Object.defineProperty(this,"data",{value:y(e,this,[]),writable:!1})};return v.prototype={data:null,getData:function(){return this.data},getId:function(){return this.id},watch:function(t,e,r){return u(t)&&(r=e,e=t,t=[]),e=e.bind(r||this),l(this.getId(),t,e),this}},v.observable=o,v.supported=function(){try{return new Proxy({},{}),!0}catch(t){return!1}},v.type={MODIFIED:"mod",ADDED:"add",DELETED:"del"},v});